<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Youth Voice & Social Involvement ‚Äî Profile Survey</title>
  <meta name="description" content="A bright, teen-friendly survey that assigns students a social involvement profile and lets the teacher export results to CSV." />

  <style>
    :root{
      --bgA:#f6fbff;
      --bgB:#fff7fb;
      --bgC:#f7fff7;
      --ink:#10213a;
      --muted:#485a79;

      --card: rgba(255,255,255,.84);
      --stroke: rgba(16,33,58,.12);
      --shadow: 0 18px 60px rgba(16,33,58,.14);

      --radius: 18px;
      --radius2: 26px;

      --a1:#7c3aed; /* purple */
      --a2:#06b6d4; /* cyan */
      --a3:#f97316; /* orange */
      --a4:#22c55e; /* green */
      --a5:#ef4444; /* red */
      --a6:#facc15; /* yellow */

      --focus: 0 0 0 4px rgba(6,182,212,.25);
      --max: 1100px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--ink);
      background:
        radial-gradient(1100px 620px at 8% 8%, rgba(124,58,237,.14), transparent 62%),
        radial-gradient(1100px 620px at 92% 12%, rgba(6,182,212,.18), transparent 62%),
        radial-gradient(1100px 620px at 18% 98%, rgba(249,115,22,.14), transparent 62%),
        radial-gradient(900px 560px at 88% 90%, rgba(34,197,94,.12), transparent 62%),
        linear-gradient(180deg, var(--bgA), var(--bgB), var(--bgC));
      overflow-x:hidden;
    }

    /* Background doodles */
    .doodle{
      position: fixed;
      inset: 0;
      pointer-events:none;
      opacity:.7;
      z-index:0;
      filter: drop-shadow(0 10px 18px rgba(16,33,58,.08));
    }

    .wrap{
      position: relative;
      z-index:1;
      max-width: var(--max);
      margin: 0 auto;
      padding: 26px 18px 86px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin: 6px 0 18px;
      flex-wrap:wrap;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border: 1px solid var(--stroke);
      border-radius: 999px;
      background: rgba(255,255,255,.76);
      backdrop-filter: blur(8px);
      box-shadow: 0 12px 34px rgba(16,33,58,.12);
      letter-spacing: .2px;
      font-size: 13px;
      color: var(--muted);
    }
    .badge strong{color: var(--ink); font-weight: 860}

    .toolbar{display:flex; gap:10px; flex-wrap:wrap}

    .btn{
      cursor:pointer;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.80);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 820;
      letter-spacing: .15px;
      box-shadow: 0 12px 30px rgba(16,33,58,.12);
      transition: transform .06s ease, filter .15s ease, background .2s ease, border-color .2s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{filter: brightness(1.03)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border-color: rgba(6,182,212,.34);
      background: linear-gradient(135deg, rgba(6,182,212,.24), rgba(124,58,237,.14));
    }
    .btn.danger{
      border-color: rgba(239,68,68,.22);
      background: linear-gradient(135deg, rgba(239,68,68,.14), rgba(249,115,22,.12));
    }
    .btn:focus{outline:none; box-shadow: var(--focus), 0 12px 30px rgba(16,33,58,.12)}

    header.hero{
      position:relative;
      border: 1px solid var(--stroke);
      border-radius: var(--radius2);
      padding: 22px 20px;
      background:
        radial-gradient(900px 420px at 10% 10%, rgba(6,182,212,.14), transparent 60%),
        radial-gradient(900px 420px at 90% 20%, rgba(124,58,237,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.66)),
        url("https://images.unsplash.com/photo-1523050854058-8df90110c9f1?auto=format&fit=crop&w=1800&q=70");
      background-size: auto, auto, auto, cover;
      background-position: center, center, center, center;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(260px 140px at 20% 25%, rgba(249,115,22,.20), transparent 60%),
        radial-gradient(240px 130px at 70% 30%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(240px 130px at 90% 90%, rgba(250,204,21,.20), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .hero > *{position:relative}

    .hgrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      align-items: start;
    }
    @media (max-width: 860px){ .hgrid{grid-template-columns: 1fr} }

    h1{
      margin: 0 0 10px;
      font-size: clamp(26px, 4.1vw, 42px);
      letter-spacing: -0.7px;
      line-height: 1.05;
    }
    .sub{
      margin:0 0 10px;
      color: var(--muted);
      font-size: 15px;
      line-height: 1.55;
      max-width: 72ch;
    }

    .notes{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.72);
      color: var(--muted);
      font-size: 13px;
      display:inline-flex; align-items:center; gap:8px;
      box-shadow: 0 10px 22px rgba(16,33,58,.10);
    }

    /* Photo strip (stable height so "third photo" never breaks layout) */
    .photoStrip{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap:10px;
      margin-top: 14px;
    }
    @media (max-width: 860px){ .photoStrip{grid-template-columns: repeat(2, minmax(0,1fr));} }

    .pthumb{
      border:1px solid var(--stroke);
      border-radius: 18px;
      overflow:hidden;
      background: rgba(255,255,255,.78);
      box-shadow: 0 12px 34px rgba(16,33,58,.12);
      height: 96px;              /* FIXED HEIGHT */
      position:relative;
    }
    .pthumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.06) contrast(1.02);
    }
    .pthumb:after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.00), rgba(0,0,0,.28));
      pointer-events:none;
    }
    .pthumb span{
      position:absolute;
      left:10px; bottom:8px;
      font-size: 12px;
      font-weight: 900;
      color: rgba(255,255,255,.96);
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      letter-spacing:.2px;
      z-index:1;
    }

    .miniCard{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.74);
      border-radius: var(--radius);
      padding: 14px 14px 10px;
      box-shadow: 0 12px 38px rgba(16,33,58,.12);
    }
    .miniTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight: 900; letter-spacing: .2px;
      margin-bottom: 8px;
    }
    .miniTitle span{color: var(--muted); font-weight: 820}
    .miniText{color: var(--muted); font-size: 13px; line-height: 1.45; margin: 0 0 10px;}

    .meter{
      height: 12px;
      border-radius: 999px;
      background: rgba(16,33,58,.06);
      border: 1px solid rgba(16,33,58,.10);
      overflow:hidden;
    }
    .meter > div{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(6,182,212,.90), rgba(124,58,237,.78), rgba(249,115,22,.78), rgba(34,197,94,.72));
      transition: width .25s ease;
    }

    main{ margin-top: 16px; }

    .panel{
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.78);
      border-radius: var(--radius2);
      padding: 18px;
      box-shadow: var(--shadow);
    }

    .small{
      font-size: 13.5px;
      color: var(--muted);
      line-height:1.6;
    }

    .nameRow{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:flex-end;
      margin-top: 12px;
      padding: 12px;
      border: 1px solid rgba(16,33,58,.10);
      border-radius: 18px;
      background: rgba(255,255,255,.70);
      box-shadow: 0 10px 22px rgba(16,33,58,.08);
    }
    .nameBox{flex:1; min-width:240px}
    .nameBox label{
      display:block;
      font-weight: 950;
      letter-spacing: -.1px;
      margin-bottom: 6px;
    }
    .nameBox input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(16,33,58,.18);
      background: rgba(255,255,255,.92);
      font-weight: 800;
      color: var(--ink);
    }
    .nameBox input:focus{outline:none; box-shadow: var(--focus)}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 14px;
    }

    .q{
      border:1px solid rgba(16,33,58,.10);
      background: rgba(255,255,255,.84);
      border-radius: var(--radius);
      padding: 14px;
      overflow:hidden;
      box-shadow: 0 12px 30px rgba(16,33,58,.10);
      position:relative;
    }
    .q:before{
      content:"";
      position:absolute;
      width: 86px;
      height: 86px;
      right: -34px;
      top: -34px;
      border-radius: 28px;
      background:
        radial-gradient(circle at 30% 30%, rgba(6,182,212,.34), transparent 60%),
        radial-gradient(circle at 70% 70%, rgba(124,58,237,.28), transparent 60%),
        radial-gradient(circle at 30% 80%, rgba(249,115,22,.24), transparent 60%);
      transform: rotate(18deg);
      opacity:.88;
    }

    .qhead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 12px;
      position:relative;
      z-index:1;
    }

    .qnum{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(71,90,122,.95);
      letter-spacing:.35px;
      padding: 6px 8px;
      border: 1px solid rgba(16,33,58,.12);
      border-radius: 999px;
      background: rgba(255,255,255,.74);
      flex: 0 0 auto;
      margin-top: 2px;
      box-shadow: 0 8px 18px rgba(16,33,58,.08);
    }

    .qtext{
      margin:0;
      font-weight: 950;
      letter-spacing: -.15px;
      line-height:1.25;
      font-size: 16px;
      color: var(--ink);
    }
    .qhint{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .options{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 10px;
      position:relative;
      z-index:1;
    }
    @media (max-width: 680px){ .options{grid-template-columns: 1fr} }

    .opt{
      position:relative;
      display:flex;
      align-items:flex-start;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(16,33,58,.12);
      background: rgba(255,255,255,.92);
      cursor:pointer;
      transition: transform .06s ease, filter .15s ease, border-color .2s ease;
      user-select:none;
      min-height: 58px;
      box-shadow: 0 10px 22px rgba(16,33,58,.08);
    }
    .opt:hover{filter: brightness(1.02); border-color: rgba(124,58,237,.20);}
    .opt:active{transform: translateY(1px)}

    .opt input{
      appearance:none;
      -webkit-appearance:none;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(16,33,58,.32);
      margin-top: 2px;
      flex: 0 0 auto;
      position:relative;
      background: rgba(255,255,255,.98);
    }
    .opt input:checked{
      border-color: rgba(6,182,212,.95);
      box-shadow: 0 0 0 4px rgba(6,182,212,.18);
    }
    .opt input:checked:after{
      content:"";
      position:absolute;
      inset: 3px;
      border-radius:999px;
      background: linear-gradient(135deg, rgba(6,182,212,.95), rgba(124,58,237,.85));
    }

    .opt .olabel{display:flex; flex-direction:column; gap: 2px; min-width:0;}
    .otitle{font-weight: 930; letter-spacing: -.1px; font-size: 14px; line-height:1.2; color: var(--ink);}
    .odesc{font-size: 12.5px; line-height:1.35; color: var(--muted);}

    .bottomActions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(16,33,58,.10);
    }

    /* ===== RESULTS MODAL (FIXED SCROLLING) ===== */
    dialog#resultDialog{
      width: min(940px, calc(100% - 22px));
      max-height: 92vh;                 /* key fix */
      border: 1px solid rgba(16,33,58,.14);
      border-radius: 22px;
      background:
        radial-gradient(900px 500px at 10% 0%, rgba(6,182,212,.20), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(124,58,237,.16), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.78));
      color: var(--ink);
      box-shadow: 0 24px 90px rgba(16,33,58,.26);
      padding: 0;
      overflow: hidden;                /* internal scroll in modalBody */
      display:flex;
      flex-direction: column;
    }
    dialog#resultDialog::backdrop{
      background: rgba(16,33,58,.52);
      backdrop-filter: blur(6px);
    }

    .modalHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      padding: 16px 16px 10px;
      border-bottom: 1px solid rgba(16,33,58,.10);
      flex: 0 0 auto;
    }
    .modalHead h2{
      margin:0;
      font-size: 18px;
      letter-spacing: -.2px;
    }

    .modalBody{
      padding: 14px 16px 18px;
      flex: 1 1 auto;
      overflow: auto;                 /* scroll here */
      -webkit-overflow-scrolling: touch;
    }

    .resultGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 820px){ .resultGrid{grid-template-columns:1fr} }

    .resultCard{
      border:1px solid rgba(16,33,58,.12);
      background: rgba(255,255,255,.86);
      border-radius: 20px;
      padding: 14px;
      overflow:hidden;
      position:relative;
      box-shadow: 0 12px 34px rgba(16,33,58,.12);
    }

    .profileRow{display:flex; gap: 12px; align-items:center; margin-bottom: 10px;}

    .avatar{
      width: 54px;
      height: 54px;
      border-radius: 18px;
      border: 1px solid rgba(16,33,58,.12);
      background:
        radial-gradient(circle at 30% 30%, rgba(6,182,212,.22), transparent 60%),
        radial-gradient(circle at 70% 70%, rgba(124,58,237,.18), transparent 60%),
        rgba(255,255,255,.92);
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }

    /* Profile photo in results (stable height so nothing looks "broken") */
    .profilePhoto{
      border:1px solid rgba(16,33,58,.12);
      border-radius: 18px;
      overflow:hidden;
      height: 140px;
      box-shadow: 0 12px 34px rgba(16,33,58,.12);
      margin: 8px 0 12px;
      background: rgba(255,255,255,.92);
    }
    .profilePhoto img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.05) contrast(1.02);
    }

    .pname{margin:0; font-size: 18px; letter-spacing: -.3px; font-weight: 980; line-height:1.05;}
    .ptag{margin: 4px 0 0; color: var(--muted); font-size: 13px; line-height:1.35;}

    .barWrap{margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(16,33,58,.10);}
    .barLine{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom: 6px; font-size: 13px; color: var(--muted);}
    .bars{display:grid; gap: 8px; margin-top: 8px;}
    .bar{
      height: 12px;
      border-radius: 999px;
      background: rgba(16,33,58,.06);
      border: 1px solid rgba(16,33,58,.10);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(6,182,212,.92), rgba(124,58,237,.80), rgba(249,115,22,.80));
      transition: width .25s ease;
    }

    .callout{
      margin-top: 12px;
      border:1px dashed rgba(16,33,58,.18);
      background: rgba(255,255,255,.80);
      border-radius: 18px;
      padding: 12px;
      color: var(--muted);
      line-height: 1.55;
      font-size: 13px;
    }

    .twoCol{display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;}
    @media (max-width: 820px){ .twoCol{grid-template-columns:1fr} }

    .list{margin: 8px 0 0; padding-left: 18px; color: var(--muted); font-size: 13px; line-height: 1.6;}

    .footerBtns{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap: 10px;
      padding: 12px 16px 16px;
      border-top: 1px solid rgba(16,33,58,.10);
      flex-wrap:wrap;
      flex: 0 0 auto;
      background: rgba(255,255,255,.55);
    }

    @media print{
      body{background:white; color:black}
      .doodle, .topbar, .toolbar, .btn, .meter, dialog{display:none !important}
      header.hero, .panel, .q{box-shadow:none; background:white; border:1px solid #ddd}
      .opt{border:1px solid #ddd; background:white; box-shadow:none}
      .opt input{border-color:#333}
      .wrap{max-width: 900px}
    }
  </style>
</head>

<body>
  <!-- Background doodles (inline SVG, no external files) -->
  <svg class="doodle" viewBox="0 0 1200 800" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <linearGradient id="g1" x1="0" x2="1">
        <stop offset="0" stop-color="rgba(6,182,212,.45)"/>
        <stop offset="1" stop-color="rgba(124,58,237,.35)"/>
      </linearGradient>
      <linearGradient id="g2" x1="0" x2="1">
        <stop offset="0" stop-color="rgba(249,115,22,.40)"/>
        <stop offset="1" stop-color="rgba(34,197,94,.32)"/>
      </linearGradient>
    </defs>

    <g opacity=".55">
      <circle cx="90" cy="120" r="6" fill="rgba(6,182,212,.65)"/>
      <circle cx="140" cy="170" r="4" fill="rgba(124,58,237,.60)"/>
      <circle cx="210" cy="90" r="5" fill="rgba(249,115,22,.65)"/>
      <circle cx="1080" cy="120" r="6" fill="rgba(34,197,94,.60)"/>
      <circle cx="1040" cy="200" r="4" fill="rgba(124,58,237,.55)"/>
      <circle cx="1120" cy="220" r="5" fill="rgba(6,182,212,.60)"/>
      <circle cx="160" cy="690" r="6" fill="rgba(239,68,68,.55)"/>
      <circle cx="260" cy="720" r="4" fill="rgba(6,182,212,.55)"/>
      <circle cx="1040" cy="700" r="6" fill="rgba(249,115,22,.55)"/>
      <circle cx="1120" cy="650" r="4" fill="rgba(34,197,94,.55)"/>
      <circle cx="640" cy="120" r="5" fill="rgba(250,204,21,.55)"/>
      <circle cx="760" cy="170" r="4" fill="rgba(6,182,212,.48)"/>
    </g>

    <path d="M-40 260 C 120 180, 220 330, 380 250 C 520 180, 650 210, 760 160 C 900 95, 1030 170, 1240 120"
          fill="none" stroke="url(#g1)" stroke-width="16" stroke-linecap="round" opacity=".35"/>
    <path d="M-40 560 C 160 520, 220 650, 420 600 C 600 555, 720 620, 880 560 C 1010 510, 1080 590, 1240 520"
          fill="none" stroke="url(#g2)" stroke-width="18" stroke-linecap="round" opacity=".26"/>
  </svg>

  <div class="wrap">
    <div class="topbar">
      <div class="badge" title="Classroom-friendly survey">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 2l8 4v6c0 5-3.3 9.4-8 10-4.7-.6-8-5-8-10V6l8-4z" stroke="currentColor" stroke-width="1.8" opacity=".9"/>
          <path d="M8.5 12l2.2 2.3L15.5 9.6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <strong>Youth Voice Survey</strong> <span>‚Äî your profile at the end</span>
      </div>

      <div class="toolbar">
        <button class="btn" id="btnAutofill" type="button" title="Fill randomly (demo)">Demo fill</button>
        <button class="btn danger" id="btnReset" type="button" title="Clear answers">Reset</button>
        <button class="btn primary" id="btnResults" type="button">See my profile</button>
      </div>
    </div>

    <header class="hero">
      <div class="hgrid">
        <div>
          <h1>How do you help your school?</h1>
          <p class="sub">
            Answer 20 quick questions. At the end, you get a profile:
            <strong>Voice</strong>, <strong>Supporter</strong>, <strong>Doer</strong>, or <strong>Thinker</strong>.
          </p>

          <div class="notes">
            <div class="chip" title="Time">
              ‚è±Ô∏è 6‚Äì8 minutes
            </div>
            <div class="chip" title="No right or wrong">
              ‚úÖ No right / wrong
            </div>
            <div class="chip" title="Privacy">
              üîí Private on this device
            </div>
          </div>

          <div class="photoStrip" aria-label="Inspiration photos">
            <div class="pthumb">
              <img alt="Teamwork" src="https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=900&q=70">
              <span>Teamwork</span>
            </div>
            <div class="pthumb">
              <img alt="Student voice" src="https://images.unsplash.com/photo-1523240795612-9a054b0db644?auto=format&fit=crop&w=900&q=70">
              <span>Voice</span>
            </div>
            <div class="pthumb">
              <img alt="Support and community" src="https://images.unsplash.com/photo-1529156069898-49953e39b3ac?auto=format&fit=crop&w=900&q=70">
              <span>Support</span>
            </div>
            <div class="pthumb">
              <img alt="Thinking and planning" src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?auto=format&fit=crop&w=900&q=70">
              <span>Think</span>
            </div>
          </div>
        </div>

        <div class="miniCard">
          <div class="miniTitle">
            <span>Progress</span>
            <strong id="progressText">0 / 20</strong>
          </div>
          <p class="miniText">Answer all questions for the best result.</p>
          <div class="meter" aria-label="Progress"><div id="progressBar"></div></div>
          <p class="miniText" style="margin-top:10px">
            If you tie, you will get a ‚Äúblend‚Äù.
          </p>
        </div>
      </div>
    </header>

    <main class="panel" aria-label="Survey">
      <div class="small">
        <strong>Teacher note:</strong> Students type a name (or initials). When results open, the page saves the score on this device.
        You can export a CSV for Google Sheets / Excel.
      </div>

      <div class="nameRow" aria-label="Student info and export">
        <div class="nameBox">
          <label for="studentName">Student name (or initials)</label>
          <input id="studentName" type="text" placeholder="e.g., Alex R." autocomplete="off" />
          <div class="small" style="margin-top:6px">Use initials if you prefer privacy.</div>
        </div>
        <button class="btn" type="button" id="btnExportCSV" title="Download results as CSV">Export CSV</button>
        <button class="btn danger" type="button" id="btnClearClass" title="Clear saved results on this device">Clear saved results</button>
      </div>

      <div class="grid" id="questions"></div>

      <div class="bottomActions">
        <div class="small">
          <strong>Tip:</strong> Click an option. You can change your answer.
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn" type="button" id="btnPrint">Print</button>
          <button class="btn primary" type="button" id="btnResults2">See my profile</button>
        </div>
      </div>
    </main>
  </div>

  <dialog id="resultDialog" aria-label="Results">
    <div class="modalHead">
      <h2>Your Profile</h2>
      <button class="btn" type="button" id="btnClose">Close</button>
    </div>

    <div class="modalBody">
      <div class="resultGrid">
        <div class="resultCard" id="primaryCard"></div>

        <div class="resultCard">
          <div class="profileRow">
            <div class="avatar" aria-hidden="true" id="blendIcon"></div>
            <div>
              <p class="pname" style="margin:0">Score</p>
              <p class="ptag" id="scoreLine">‚Äî</p>
            </div>
          </div>

          <div class="bars" aria-label="Score bars">
            <div>
              <div class="barLine"><span>Voice</span><span id="vScore">0</span></div>
              <div class="bar"><div id="vBar"></div></div>
            </div>
            <div>
              <div class="barLine"><span>Supporter</span><span id="sScore">0</span></div>
              <div class="bar"><div id="sBar"></div></div>
            </div>
            <div>
              <div class="barLine"><span>Doer</span><span id="dScore">0</span></div>
              <div class="bar"><div id="dBar"></div></div>
            </div>
            <div>
              <div class="barLine"><span>Thinker</span><span id="tScore">0</span></div>
              <div class="bar"><div id="tBar"></div></div>
            </div>
          </div>

          <div class="callout" id="tieNote" style="display:none">
            Tie = you are strong in more than one role. That is good.
          </div>

          <div class="callout" id="saveNote" style="margin-top:10px">
            Saved: If you entered a name and finished all questions, your result is saved for CSV export.
          </div>
        </div>
      </div>

      <div class="twoCol">
        <div class="resultCard" id="teamTips"></div>
        <div class="resultCard" id="nextStep"></div>
      </div>
    </div>

    <div class="footerBtns">
      <button class="btn" type="button" id="btnCopy">Copy results</button>
      <button class="btn primary" type="button" id="btnPrintResult">Print results</button>
    </div>
  </dialog>

  <script>
    // ===== Icons (no external files) =====
    const icons = {
      Voice: `
        <svg width="34" height="34" viewBox="0 0 64 64" fill="none" aria-hidden="true">
          <path d="M18 28c0-8 6-14 14-14s14 6 14 14v8c0 8-6 14-14 14s-14-6-14-14v-8z" stroke="currentColor" stroke-width="2"/>
          <path d="M18 34H10c-4 0-6 3-6 6v4h10" stroke="currentColor" stroke-width="2" opacity=".9"/>
          <path d="M46 34h8c4 0 6 3 6 6v4H50" stroke="currentColor" stroke-width="2" opacity=".9"/>
          <path d="M24 52c2 3 5 5 8 5s6-2 8-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M26 28h12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".9"/>
        </svg>
      `,
      Supporter: `
        <svg width="34" height="34" viewBox="0 0 64 64" fill="none" aria-hidden="true">
          <path d="M32 56s-18-10-18-28c0-7 6-12 13-12 3 0 6 1 8 4 2-3 5-4 8-4 7 0 13 5 13 12 0 18-18 28-18 28z" stroke="currentColor" stroke-width="2"/>
          <path d="M24 40c2 3 5 5 8 5s6-2 8-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      `,
      Doer: `
        <svg width="34" height="34" viewBox="0 0 64 64" fill="none" aria-hidden="true">
          <path d="M22 50h20l6-22H16l6 22z" stroke="currentColor" stroke-width="2"/>
          <path d="M26 34h12M26 40h12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".85"/>
          <path d="M10 50h44" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".7"/>
        </svg>
      `,
      Thinker: `
        <svg width="34" height="34" viewBox="0 0 64 64" fill="none" aria-hidden="true">
          <path d="M24 50h16v-6c5-3 8-8 8-14 0-9-7-16-16-16S16 21 16 30c0 6 3 11 8 14v6z" stroke="currentColor" stroke-width="2"/>
          <path d="M26 56h12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".8"/>
          <path d="M26 30h12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".9"/>
        </svg>
      `
    };

    // Stable photo set (no "broken third photo" sizing issues)
    const profilePhotos = {
      Voice: "https://images.unsplash.com/photo-1523240795612-9a054b0db644?auto=format&fit=crop&w=1400&q=70",
      Supporter: "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?auto=format&fit=crop&w=1400&q=70",
      Doer: "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=1400&q=70",
      Thinker: "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?auto=format&fit=crop&w=1400&q=70"
    };

    // Simplified language for 3¬∫ ESO
    const profiles = {
      Voice: {
        name: "Voice",
        tag: "You speak up and share ideas respectfully.",
        strengths: ["Clear speaker", "Starts discussions", "Shares ideas", "Encourages others"],
        helpsBy: ["Explain the message", "Present to others", "Start a class talk", "Raise awareness"],
        classroom: "Good roles: spokesperson, presenter, discussion leader."
      },
      Supporter: {
        name: "Supporter",
        tag: "You help people feel safe, included, and respected.",
        strengths: ["Kind", "Good listener", "Team helper", "Fair-minded"],
        helpsBy: ["Include others", "Support classmates", "Calm conflict", "Build a good vibe"],
        classroom: "Good roles: peer helper, inclusion leader, community builder."
      },
      Doer: {
        name: "Doer",
        tag: "You turn ideas into action and get things done.",
        strengths: ["Action-focused", "Reliable", "Organized", "Practical"],
        helpsBy: ["Plan tasks", "Follow through", "Set up materials", "Make it happen"],
        classroom: "Good roles: organizer, project manager, logistics."
      },
      Thinker: {
        name: "Thinker",
        tag: "You ask smart questions and look for good reasons.",
        strengths: ["Curious", "Logical", "Evidence-based", "Good planner"],
        helpsBy: ["Research", "Ask why", "Check facts", "Improve decisions"],
        classroom: "Good roles: researcher, strategist, fact-checker."
      }
    };

    // 20 questions, simpler wording
    const Q = [
      { t:"If something feels unfair at school, you usually‚Ä¶",
        h:"Choose the option that fits you best.",
        o:[
          {k:"Voice", title:"Speak up", desc:"I say something politely."},
          {k:"Supporter", title:"Support someone", desc:"I check on the person."},
          {k:"Doer", title:"Fix what I can", desc:"I take action to help."},
          {k:"Thinker", title:"Ask why", desc:"I try to understand the cause."}
        ]
      },
      { t:"In a group project, you are usually the one who‚Ä¶",
        h:"Think about what you do most.",
        o:[
          {k:"Voice", title:"Shares ideas", desc:"I talk and explain the message."},
          {k:"Supporter", title:"Includes everyone", desc:"I make sure all join in."},
          {k:"Doer", title:"Organizes tasks", desc:"I plan and start the work."},
          {k:"Thinker", title:"Researches", desc:"I find info and facts."}
        ]
      },
      { t:"Which line sounds most like you?",
        h:"Pick one.",
        o:[
          {k:"Voice", title:"‚ÄúPeople should hear this.‚Äù", desc:"I want to share the message."},
          {k:"Supporter", title:"‚ÄúPeople should feel safe.‚Äù", desc:"I care about respect."},
          {k:"Doer", title:"‚ÄúLet‚Äôs do something now.‚Äù", desc:"I want action."},
          {k:"Thinker", title:"‚ÄúLet‚Äôs understand first.‚Äù", desc:"I want the full picture."}
        ]
      },
      { t:"For a class event, you prefer to‚Ä¶",
        h:"Example: posters, fundraiser, clean-up.",
        o:[
          {k:"Voice", title:"Present", desc:"I talk to others and promote it."},
          {k:"Supporter", title:"Welcome people", desc:"I help others feel comfortable."},
          {k:"Doer", title:"Set it up", desc:"I handle tasks and materials."},
          {k:"Thinker", title:"Plan it", desc:"I design a smart plan."}
        ]
      },
      { t:"When someone disagrees with you, you usually‚Ä¶",
        h:"Pick your most common reaction.",
        o:[
          {k:"Voice", title:"Explain my point", desc:"I share reasons clearly."},
          {k:"Supporter", title:"Listen first", desc:"I try to understand them."},
          {k:"Doer", title:"Find a solution", desc:"I ask: what can we do?"},
          {k:"Thinker", title:"Ask questions", desc:"I ask for details and facts."}
        ]
      },
      { t:"What matters most for a better school?",
        h:"No wrong answer.",
        o:[
          {k:"Voice", title:"Students speak up", desc:"People share ideas."},
          {k:"Supporter", title:"Respect and kindness", desc:"People feel safe."},
          {k:"Doer", title:"Real action", desc:"Things actually change."},
          {k:"Thinker", title:"Good understanding", desc:"Better ideas and choices."}
        ]
      },
      { t:"If someone is treated unfairly, you are more likely to‚Ä¶",
        h:"What do you do first?",
        o:[
          {k:"Voice", title:"Say something", desc:"I speak up respectfully."},
          {k:"Supporter", title:"Check on them", desc:"I offer support."},
          {k:"Doer", title:"Stop it / get help", desc:"I take steps quickly."},
          {k:"Thinker", title:"Understand the situation", desc:"I find out what happened."}
        ]
      },
      { t:"Which task sounds fun for you?",
        h:"Pick what gives you energy.",
        o:[
          {k:"Voice", title:"Present or debate", desc:"I like speaking."},
          {k:"Supporter", title:"Help someone", desc:"I like supporting people."},
          {k:"Doer", title:"Build / organize", desc:"I like hands-on work."},
          {k:"Thinker", title:"Investigate", desc:"I like research and thinking."}
        ]
      },
      { t:"When a plan is not working, you usually‚Ä¶",
        h:"Pick what you do most.",
        o:[
          {k:"Voice", title:"Suggest a new idea", desc:"I explain a better direction."},
          {k:"Supporter", title:"Help the team", desc:"I keep the group calm."},
          {k:"Doer", title:"Try a different method", desc:"I test another way."},
          {k:"Thinker", title:"Find the root problem", desc:"I diagnose what‚Äôs wrong."}
        ]
      },
      { t:"If you could improve ONE thing at school, it would be‚Ä¶",
        h:"Pick the closest.",
        o:[
          {k:"Voice", title:"More student voice", desc:"More say in decisions."},
          {k:"Supporter", title:"More respect", desc:"Less bullying, more belonging."},
          {k:"Doer", title:"Better routines", desc:"Clear systems and spaces."},
          {k:"Thinker", title:"Better understanding", desc:"Learn about real problems + solutions."}
        ]
      },
      { t:"If your group is quiet, you usually‚Ä¶",
        h:"What do you do first?",
        o:[
          {k:"Voice", title:"Start talking", desc:"I open the conversation."},
          {k:"Supporter", title:"Invite others", desc:"I ask quiet people to share."},
          {k:"Doer", title:"Start a task", desc:"I begin something practical."},
          {k:"Thinker", title:"Ask a guiding question", desc:"I ask: what is our goal?"}
        ]
      },
      { t:"A big challenge is given. Your first move is‚Ä¶",
        h:"Pick the closest.",
        o:[
          {k:"Voice", title:"Share an idea", desc:"I say a possible solution."},
          {k:"Supporter", title:"Boost the group", desc:"I keep people positive."},
          {k:"Doer", title:"Make steps", desc:"I list steps and start."},
          {k:"Thinker", title:"Understand the task", desc:"I read carefully and clarify."}
        ]
      },
      { t:"If two classmates have conflict, you tend to‚Ä¶",
        h:"What do you do first?",
        o:[
          {k:"Voice", title:"Speak for fairness", desc:"I say what‚Äôs respectful."},
          {k:"Supporter", title:"Help them calm down", desc:"I listen and support."},
          {k:"Doer", title:"Get help / set a plan", desc:"I take action to stop it."},
          {k:"Thinker", title:"Ask what happened", desc:"I gather facts first."}
        ]
      },
      { t:"When planning an event, you are best at‚Ä¶",
        h:"What would people thank you for?",
        o:[
          {k:"Voice", title:"Promoting it", desc:"I create the message."},
          {k:"Supporter", title:"Making it welcoming", desc:"I include everyone."},
          {k:"Doer", title:"Logistics", desc:"I handle time, materials, setup."},
          {k:"Thinker", title:"Structure", desc:"I plan rules and format."}
        ]
      },
      { t:"If someone says ‚ÄúThat won‚Äôt work,‚Äù you‚Ä¶",
        h:"Choose your likely response.",
        o:[
          {k:"Voice", title:"Explain why it can work", desc:"I defend the idea clearly."},
          {k:"Supporter", title:"Keep it respectful", desc:"I protect the tone."},
          {k:"Doer", title:"Test a small version", desc:"I try a quick experiment."},
          {k:"Thinker", title:"Ask for evidence", desc:"I ask: why do you think so?"}
        ]
      },
      { t:"When you learn about a problem, you want to‚Ä¶",
        h:"Pick what you need most.",
        o:[
          {k:"Voice", title:"Talk about it", desc:"Discussion helps me."},
          {k:"Supporter", title:"Think about people", desc:"I focus on feelings + impact."},
          {k:"Doer", title:"Find a first step", desc:"I want something doable now."},
          {k:"Thinker", title:"Study it deeper", desc:"I want reliable info."}
        ]
      },
      { t:"A new student joins your class. You are most likely to‚Ä¶",
        h:"Pick what you would do.",
        o:[
          {k:"Voice", title:"Introduce them", desc:"I connect them to others."},
          {k:"Supporter", title:"Check in privately", desc:"I ask if they are okay."},
          {k:"Doer", title:"Show routines", desc:"I explain how things work."},
          {k:"Thinker", title:"Explain expectations", desc:"I clarify rules and systems."}
        ]
      },
      { t:"You feel proud of a project when‚Ä¶",
        h:"What feels like success?",
        o:[
          {k:"Voice", title:"People got the message", desc:"It changed minds."},
          {k:"Supporter", title:"People felt included", desc:"The team felt safe."},
          {k:"Doer", title:"It happened for real", desc:"We delivered something."},
          {k:"Thinker", title:"It was well-planned", desc:"Good reasons and evidence."}
        ]
      },
      { t:"If you could lead a school club, you‚Äôd choose‚Ä¶",
        h:"Pick your vibe.",
        o:[
          {k:"Voice", title:"Debate / Media", desc:"Share ideas and speak."},
          {k:"Supporter", title:"Peer support", desc:"Help people connect."},
          {k:"Doer", title:"Service / Makers", desc:"Build and organize."},
          {k:"Thinker", title:"Science / Research", desc:"Investigate and improve."}
        ]
      }
    ];

    // ===== Render questions =====
    const questionsEl = document.getElementById("questions");
    const progressText = document.getElementById("progressText");
    const progressBar = document.getElementById("progressBar");

    function uid(){ return Math.random().toString(16).slice(2); }
    const surveyId = uid();
    progressText.textContent = `0 / ${Q.length}`;

    Q.forEach((q, i) => {
      const qEl = document.createElement("section");
      qEl.className = "q";
      qEl.dataset.index = i;

      const head = document.createElement("div");
      head.className = "qhead";

      const left = document.createElement("div");
      left.style.minWidth = "0";

      const title = document.createElement("p");
      title.className = "qtext";
      title.textContent = q.t;

      const hint = document.createElement("p");
      hint.className = "qhint";
      hint.textContent = q.h;

      left.appendChild(title);
      left.appendChild(hint);

      const num = document.createElement("div");
      num.className = "qnum";
      num.textContent = `Q${i+1}`;

      head.appendChild(left);
      head.appendChild(num);

      const opts = document.createElement("div");
      opts.className = "options";

      q.o.forEach((opt, j) => {
        const label = document.createElement("label");
        label.className = "opt";
        const name = `q_${surveyId}_${i}`;
        const id = `${name}_${j}`;

        label.innerHTML = `
          <input type="radio" name="${name}" id="${id}" value="${opt.k}">
          <div class="olabel">
            <div class="otitle">${opt.title}</div>
            <div class="odesc">${opt.desc}</div>
          </div>
        `;

        label.querySelector("input").addEventListener("change", updateProgress);
        opts.appendChild(label);
      });

      qEl.appendChild(head);
      qEl.appendChild(opts);
      questionsEl.appendChild(qEl);
    });

    function getAnswers(){
      const counts = {Voice:0, Supporter:0, Doer:0, Thinker:0};
      let answered = 0;
      Q.forEach((_, i) => {
        const name = `q_${surveyId}_${i}`;
        const chosen = document.querySelector(`input[name="${name}"]:checked`);
        if (chosen){
          answered++;
          counts[chosen.value]++;
        }
      });
      return {counts, answered, total: Q.length};
    }

    function updateProgress(){
      const {answered, total} = getAnswers();
      progressText.textContent = `${answered} / ${total}`;
      const pct = total ? Math.round((answered/total)*100) : 0;
      progressBar.style.width = `${pct}%`;
    }
    updateProgress();

    // ===== Results UI elements =====
    const dlg = document.getElementById("resultDialog");
    const primaryCard = document.getElementById("primaryCard");
    const teamTips = document.getElementById("teamTips");
    const nextStep = document.getElementById("nextStep");
    const scoreLine = document.getElementById("scoreLine");
    const tieNote = document.getElementById("tieNote");
    const saveNote = document.getElementById("saveNote");
    const blendIcon = document.getElementById("blendIcon");

    const vScore = document.getElementById("vScore");
    const sScore = document.getElementById("sScore");
    const dScore = document.getElementById("dScore");
    const tScore = document.getElementById("tScore");

    const vBar = document.getElementById("vBar");
    const sBar = document.getElementById("sBar");
    const dBar = document.getElementById("dBar");
    const tBar = document.getElementById("tBar");

    function rankProfiles(counts){
      const entries = Object.entries(counts).sort((a,b)=> b[1]-a[1]);
      const top = entries[0][1];
      const winners = entries.filter(e => e[1] === top).map(e => e[0]);
      return {entries, winners, top};
    }

    function pct(n, total){
      if (total <= 0) return 0;
      return Math.round((n/total)*100);
    }

    function updateBars(counts){
      const total = Q.length;
      vScore.textContent = counts.Voice;
      sScore.textContent = counts.Supporter;
      dScore.textContent = counts.Doer;
      tScore.textContent = counts.Thinker;

      vBar.style.width = pct(counts.Voice, total) + "%";
      sBar.style.width = pct(counts.Supporter, total) + "%";
      dBar.style.width = pct(counts.Doer, total) + "%";
      tBar.style.width = pct(counts.Thinker, total) + "%";
    }

    // ===== Save class results + Export CSV =====
    const STORAGE_KEY = "youth_voice_class_results_v1";

    function loadClassResults(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
      catch { return []; }
    }
    function saveClassResults(rows){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
    }
    function nowISO(){
      return new Date().toISOString();
    }
    function topLabel(winners){
      return winners.length > 1 ? `Blend: ${winners.join(" + ")}` : winners[0];
    }

    function recordResultIfPossible(){
      const nameEl = document.getElementById("studentName");
      const studentName = (nameEl?.value || "").trim();

      const {counts, answered, total} = getAnswers();
      if (answered !== total) return {saved:false, reason:"incomplete"};
      if (!studentName) return {saved:false, reason:"missing-name"};

      const {winners, top} = rankProfiles(counts);

      const row = {
        timestamp: nowISO(),
        studentName,
        topProfile: topLabel(winners),
        topScore: top,
        voice: counts.Voice,
        supporter: counts.Supporter,
        doer: counts.Doer,
        thinker: counts.Thinker,
        totalQuestions: total
      };

      const rows = loadClassResults();
      rows.push(row);
      saveClassResults(rows);
      return {saved:true, row};
    }

    function toCSV(rows){
      const headers = ["timestamp","studentName","topProfile","topScore","voice","supporter","doer","thinker","totalQuestions"];
      const esc = (v) => `"${String(v ?? "").replaceAll('"','""')}"`;
      const lines = [headers.join(",")].concat(
        rows.map(r => headers.map(h => esc(r[h])).join(","))
      );
      return lines.join("\n");
    }

    function downloadTextFile(filename, content, mime="text/csv"){
      const blob = new Blob([content], {type:mime});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    document.getElementById("btnExportCSV").addEventListener("click", () => {
      const rows = loadClassResults();
      if (!rows.length){
        alert("No saved results yet. Students must enter a name and finish all questions.");
        return;
      }
      downloadTextFile("class_survey_results.csv", toCSV(rows));
    });

    document.getElementById("btnClearClass").addEventListener("click", () => {
      if (confirm("Clear all saved results on this device?")){
        localStorage.removeItem(STORAGE_KEY);
        alert("Saved results cleared.");
      }
    });

    // ===== Render results cards =====
    function renderPrimary(profileKey, winners){
      const p = profiles[profileKey];
      const blend = winners.length > 1;

      const title = blend ? `Blend: ${winners.join(" + ")}` : p.name;
      const subtitle = blend
        ? "You are strong in more than one role."
        : p.tag;

      const strengths = (blend ? winners.flatMap(w => profiles[w].strengths.slice(0,2)) : p.strengths).slice(0,6);
      const helpsBy = (blend ? winners.flatMap(w => profiles[w].helpsBy.slice(0,2)) : p.helpsBy).slice(0,6);

      const icon = blend
        ? `<div style="display:flex; gap:8px; align-items:center">
            ${winners.slice(0,2).map(w => `<div class="avatar" style="width:54px;height:54px;border-radius:18px">${icons[w]}</div>`).join("")}
          </div>`
        : `<div class="avatar">${icons[profileKey]}</div>`;

      const photoBlock = blend ? "" : `
        <div class="profilePhoto" aria-label="Profile photo">
          <img alt="${profileKey} profile photo" src="${profilePhotos[profileKey]}">
        </div>
      `;

      primaryCard.innerHTML = `
        <div class="profileRow">
          ${icon}
          <div>
            <p class="pname">${title}</p>
            <p class="ptag">${subtitle}</p>
          </div>
        </div>

        ${photoBlock}

        <div class="barWrap">
          <div class="barLine"><span>Your strengths</span><span style="color:rgba(71,90,122,.95)">${blend ? "Mixed" : "Top"}</span></div>
          <ul class="list">
            ${strengths.map(s => `<li>${s}</li>`).join("")}
          </ul>

          <div style="height:10px"></div>
          <div class="barLine"><span>Your style</span><span style="color:rgba(71,90,122,.95)">${blend ? "Flexible" : "Typical"}</span></div>
          <ul class="list">
            ${helpsBy.map(h => `<li>${h}</li>`).join("")}
          </ul>

          <div class="callout" style="margin-top:12px">
            <strong>Class role:</strong> ${blend ? "You can switch roles depending on the task." : p.classroom}
          </div>
        </div>
      `;
    }

    function renderTeamTips(winners){
      const suggestions = {
        Voice: ["Work with a Thinker for facts.", "Work with a Supporter for a good tone."],
        Supporter: ["Work with a Voice to share ideas.", "Work with a Doer to turn care into action."],
        Doer: ["Work with a Thinker to plan better.", "Work with a Supporter to keep the team connected."],
        Thinker: ["Work with a Voice to share findings.", "Work with a Doer to test ideas fast."]
      };
      const unique = [...new Set(winners.flatMap(w => suggestions[w]))];

      teamTips.innerHTML = `
        <div class="profileRow">
          <div class="avatar" aria-hidden="true">ü§ù</div>
          <div>
            <p class="pname" style="margin:0">Good teammates</p>
            <p class="ptag">Strong teams mix roles.</p>
          </div>
        </div>
        <ul class="list">
          ${unique.slice(0,6).map(x => `<li>${x}</li>`).join("")}
        </ul>
      `;
    }

    function renderNextStep(answered, total){
      const missing = total - answered;
      const prompt = (missing === 0)
        ? "Choose one small action for this week."
        : "Finish all questions for a better result.";

      const steps = [
        "Notice one thing that could be more respectful.",
        "Write one sentence: ‚ÄúA small change I want is‚Ä¶‚Äù",
        "Choose one role you want to practice (Voice / Supporter / Doer / Thinker).",
        "Work with someone who has a different role."
      ];

      nextStep.innerHTML = `
        <div class="profileRow">
          <div class="avatar" aria-hidden="true">‚úÖ</div>
          <div>
            <p class="pname" style="margin:0">Next step</p>
            <p class="ptag">${prompt}</p>
          </div>
        </div>
        <ul class="list">
          ${steps.map(s => `<li>${s}</li>`).join("")}
        </ul>
      `;
    }

    function showResults(){
      const {counts, answered, total} = getAnswers();

      // If incomplete, still show profile but warn student
      const {winners, top} = rankProfiles(counts);
      const primary = winners[0];

      scoreLine.textContent = `Answered ${answered}/${total}. Top: ${topLabel(winners)} (${top})`;
      tieNote.style.display = winners.length > 1 ? "block" : "none";

      blendIcon.innerHTML = winners.length > 1
        ? `<div style="display:flex; gap:6px">
            ${winners.slice(0,2).map(w => `<div style="width:36px;height:36px;border-radius:14px;border:1px solid rgba(16,33,58,.12);display:grid;place-items:center;background:rgba(255,255,255,.92)">${icons[w]}</div>`).join("")}
          </div>`
        : icons[primary];

      renderPrimary(primary, winners);
      updateBars(counts);
      renderTeamTips(winners);
      renderNextStep(answered, total);

      // Save result (only if name + complete)
      const saved = recordResultIfPossible();
      if (saved.saved){
        saveNote.innerHTML = `<strong>Saved:</strong> Result saved for CSV export (Name: ${saved.row.studentName}).`;
      } else if (saved.reason === "missing-name"){
        saveNote.innerHTML = `<strong>Not saved:</strong> Add your name (or initials) and open results again.`;
      } else if (saved.reason === "incomplete"){
        saveNote.innerHTML = `<strong>Not saved:</strong> Please answer all questions to save your result.`;
      }

      if (typeof dlg.showModal === "function") dlg.showModal();
      else dlg.setAttribute("open","open");
    }

    // Buttons
    document.getElementById("btnResults").addEventListener("click", showResults);
    document.getElementById("btnResults2").addEventListener("click", showResults);
    document.getElementById("btnClose").addEventListener("click", () => dlg.close());

    document.getElementById("btnPrint").addEventListener("click", () => window.print());
    document.getElementById("btnPrintResult").addEventListener("click", () => window.print());

    document.getElementById("btnReset").addEventListener("click", () => {
      Q.forEach((_, i) => {
        const name = `q_${surveyId}_${i}`;
        document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.checked = false);
      });
      updateProgress();
    });

    document.getElementById("btnAutofill").addEventListener("click", () => {
      Q.forEach((_, i) => {
        const name = `q_${surveyId}_${i}`;
        const opts = Array.from(document.querySelectorAll(`input[name="${name}"]`));
        const pick = opts[Math.floor(Math.random()*opts.length)];
        if (pick) pick.checked = true;
      });
      updateProgress();
    });

    document.getElementById("btnCopy").addEventListener("click", async () => {
      const {counts, answered, total} = getAnswers();
      const {winners, top} = rankProfiles(counts);
      const studentName = (document.getElementById("studentName").value || "").trim();

      const lines = [
        "Youth Voice Survey ‚Äî Results",
        studentName ? `Student: ${studentName}` : "Student: (not provided)",
        `Answered: ${answered}/${total}`,
        `Top profile: ${topLabel(winners)} (score ${top})`,
        `Voice: ${counts.Voice}`,
        `Supporter: ${counts.Supporter}`,
        `Doer: ${counts.Doer}`,
        `Thinker: ${counts.Thinker}`
      ].join("\n");

      try{
        await navigator.clipboard.writeText(lines);
        const btn = document.getElementById("btnCopy");
        const old = btn.textContent;
        btn.textContent = "Copied!";
        setTimeout(()=> btn.textContent = old, 1100);
      }catch(e){
        alert("Copy not available here. You can select and copy text manually.");
      }
    });

    // Close dialog on outside click
    dlg.addEventListener("click", (e) => {
      const rect = dlg.getBoundingClientRect();
      const inDialog =
        rect.top <= e.clientY && e.clientY <= rect.top + rect.height &&
        rect.left <= e.clientX && e.clientX <= rect.left + rect.width;
      if (!inDialog) dlg.close();
    });
  </script>
</body>
</html>
